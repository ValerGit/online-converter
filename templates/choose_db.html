{% extends "base-account.html" %}
{% block additional-css %}
    <link href="/plugins/jquery.steps/demo/css/jquery.steps.css" rel="stylesheet" type="text/css" />
    <link href="/plugins/sweetalert/dist/sweetalert.css" rel="stylesheet" type="text/css">

{% endblock %}
{% block activate-translation %} active {% endblock %}

{% block right-content %}
    <div class="content-page">
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col-ld-12">
                        <div class="card-box">
                            <form id="basic-form" action={% url 'view-choose-tables' %}>
                                <div>
                                    <h3>MySQL</h3>
                                    <section>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <img src="/images/mysql.jpg" alt="image"
                                                     class="img-responsive img-circle"/>
                                            </div>
                                            <div class="form-group clearfix">
                                                <div class="col-md-9">

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label " for="my-name"> Название
                                                            БД
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="my-name" name="my-name" type="text"
                                                                   class="required form-control">

                                                        </div>
                                                    </div>

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label" for="my-host"> Порт
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="my-host" name="my-port" type="text"
                                                                   class="required form-control">

                                                        </div>
                                                    </div>

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label" for="my-user">
                                                            Пользователь
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="my-user" name="my-user" type="text"
                                                                   class="required form-control">

                                                        </div>
                                                    </div>

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label" for="my-password">Пароль
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="my-password" name="my-password" type="password"
                                                                   class="required form-control">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                    <h3>MongoDB</h3>
                                    <section>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <img src="/images/mongo.png" alt="image"
                                                     class="img-responsive img-circle"/>
                                            </div>
                                            <div class="form-group clearfix">
                                                <div class="col-md-9">

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label " for="mo-name"> Название
                                                            БД
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="mo-name" name="mo-name" type="text"
                                                                   class="required form-control">

                                                        </div>
                                                    </div>

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label" for="mo-host"> Порт
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="mo-host" name="mo-port" type="text"
                                                                   class="required form-control">

                                                        </div>
                                                    </div>

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label" for="mo-user">
                                                            Пользователь
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="mo-user" name="mo-user" type="text"
                                                                   class="required form-control">

                                                        </div>
                                                    </div>

                                                    <div class="form-group clearfix">
                                                        <label class="col-lg-4 control-label" for="mo-password">Пароль
                                                        </label>

                                                        <div class="col-lg-8">
                                                            <input id="mo-password" name="mo-password" type="password"
                                                                   class="required form-control">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                    <h3>Подключиться</h3>
                                    <section>
                                        <div class="form-group clearfix">
                                            <div class="col-lg-12">
                                                <div class="checkbox checkbox-primary">
                                                    <input id="checkbox-h" type="checkbox">
                                                    <label for="checkbox-h">
                                                        I agree with the Terms and Conditions.
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block additional-scripts %}
    <!--Form Wizard-->
    <script src="/plugins/jquery.steps/build/jquery.steps.js" type="text/javascript"></script>
    <script type="text/javascript" src="/plugins/jquery-validation/dist/jquery.validate.min.js"></script>

    <!--wizard initialization-->
    <script src="/pages/jquery.wizard-init.js" type="text/javascript"></script>

    <!--form validation-->
    <script src="/plugins/bootstrapvalidator/dist/js/bootstrapValidator.js" type="text/javascript"></script>


    <script>
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                var csrftoken = getCookie('csrftoken');
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        $(document).ready(function () {

            $("#finish").click(function () {
                var myhost = $("#my-host").val();
                var myuser = $("#my-user").val();
                var mydb = $("#my-name").val();
                var mypass = $("#my-password").val();
                var myJson = {
                    'db_address': myhost, 'db_user': myuser, 'db_name': mydb, 'db_password': mypass, 'type': 'MY'
                };
                var mohost = $("#mo-host").val();
                var mouser = $("#mo-user").val();
                var modb = $("#mo-name").val();
                var mopass = $("#mo-password").val();
                var moJson = {
                    'db_address': mohost, 'db_user': mouser, 'db_name': modb, 'db_password': mopass, 'type': 'MO'
                };
                var finalJson = {
                    'from': myJson, 'to': moJson
                };
                if ((myhost == '') || (myuser == '') || (mydb == '') ||  (modb == '')) {
                    swal("Вы указали не все параметры");
                } else {
                    $.post("/connect/", JSON.stringify(finalJson),
                            function (data) {
                                if (data.valid == 'ok') {
                                    window.location.href = "/tables-choose/?from=" + data.from_id + "&to=" + data.to_id;
                                } else {
                                    swal("Введенные параметры не валидны");
                                }
                            });
                }
            });

        });
    </script>

{% endblock %}